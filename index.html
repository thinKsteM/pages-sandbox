<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>月次収支管理アプリ</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Share+Tech+Mono&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --cp-bg-dark: #1a1b26;
            --cp-bg-panel: #08080c;
            --cp-neon-cyan: #00f3ff;
            --cp-neon-pink: #ff00ff;
            --cp-neon-yellow: #ffee00;
            --cp-neon-green: #00ff41;
            --cp-text: #e0e0e0;
            --cp-text-dim: #888;
            --cp-border: #2f334d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
        }

        body {
            font-family: 'Share Tech Mono', monospace;
            background-color: var(--cp-bg-dark);
            color: var(--cp-text);
            padding: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
            appearance: textfield;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 100%;
            background-color: var(--cp-bg-dark);
            position: relative;
        }

        .container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none;
            z-index: 0;
        }

        .header {
            background: rgba(8, 8, 12, 0.95);
            border-bottom: 2px solid var(--cp-neon-cyan);
            color: var(--cp-neon-cyan);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            flex-shrink: 0;
            position: relative;
            z-index: 2;
            text-shadow: 0 0 5px var(--cp-neon-cyan);
        }

        .header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 24px;
            font-weight: 700;
            margin: 0;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: calc(90px + env(safe-area-inset-bottom));
            position: relative;
            z-index: 1;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--cp-neon-pink);
            font-weight: 600;
            border-bottom: 2px solid var(--cp-neon-pink);
            padding-bottom: 10px;
            text-align: center;
            text-shadow: 0 0 8px rgba(255, 0, 255, 0.5);
            letter-spacing: 1px;
        }

        .page-content {
            font-size: 16px;
            color: var(--cp-text);
            line-height: 1.6;
        }

        .nav {
            display: flex;
            gap: 15px;
            padding: 15px;
            padding-bottom: calc(15px + env(safe-area-inset-bottom));
            background: rgba(10, 10, 15, 0.95);
            border-top: 1px solid var(--cp-border);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 100;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .nav button {
            flex: 1;
            padding: 12px 10px;
            border: 1px solid var(--cp-border);
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--cp-text-dim);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-family: 'Share Tech Mono', monospace;
            text-transform: uppercase;
        }

        .nav button:hover {
            background-color: rgba(0, 243, 255, 0.1);
            color: var(--cp-neon-cyan);
            border-color: var(--cp-neon-cyan);
            box-shadow: 0 0 8px rgba(0, 243, 255, 0.3);
        }

        .nav button.active {
            background-color: rgba(0, 243, 255, 0.15);
            color: var(--cp-neon-cyan);
            border-color: var(--cp-neon-cyan);
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.4), inset 0 0 5px rgba(0, 243, 255, 0.2);
        }

        .summary-display {
            background: var(--cp-bg-panel);
            border: 1px solid var(--cp-neon-cyan);
            padding: 30px 20px;
            border-radius: 4px;
            text-align: center;
            margin-bottom: 25px;
            color: var(--cp-neon-cyan);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }

        .summary-display::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, transparent 50%, rgba(0, 243, 255, 0.05) 50%);
            background-size: 100% 4px;
            pointer-events: none;
        }

        .summary-display p {
            font-size: 13px;
            opacity: 0.8;
            margin-bottom: 10px;
            font-weight: 500;
            letter-spacing: 1px;
            color: var(--cp-neon-cyan);
        }

        .summary-display .amount {
            font-family: 'Orbitron', sans-serif;
            font-size: 42px;
            font-weight: 700;
            margin: 0;
            text-shadow: 0 0 10px var(--cp-neon-cyan);
            color: white;
        }

        .summary-stats {
            background-color: transparent;
            padding: 0;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .summary-stats-item {
            background-color: var(--cp-bg-panel);
            padding: 15px;
            border-radius: 4px;
            border: 1px solid var(--cp-border);
            border-left: 4px solid var(--cp-neon-pink);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .summary-stats-item:last-child {
            border-left-color: var(--cp-neon-yellow);
        }

        .summary-stats-item label {
            display: block;
            font-size: 11px;
            color: var(--cp-text-dim);
            margin-bottom: 5px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .summary-stats-item .value {
            font-family: 'Orbitron', sans-serif;
            font-size: 18px;
            font-weight: 600;
            color: var(--cp-text);
            text-shadow: 0 0 2px rgba(255, 255, 255, 0.3);
        }

        .form-section {
            background-color: var(--cp-bg-panel);
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 25px;
            border: 1px solid var(--cp-border);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--cp-neon-cyan);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #444;
            border-radius: 0;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: 'Share Tech Mono', monospace;
            background-color: #000000;
            color: #ffffff;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--cp-neon-pink);
            box-shadow: 0 0 8px rgba(255, 0, 255, 0.3);
            background-color: rgba(255, 0, 255, 0.05);
        }

        .form-group input::placeholder {
            color: #555;
        }

        .add-button {
            width: 100%;
            padding: 14px;
            background: rgba(0, 243, 255, 0.1);
            color: var(--cp-neon-cyan);
            border: 1px solid var(--cp-neon-cyan);
            border-radius: 0;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.2);
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .add-button:hover {
            background: var(--cp-neon-cyan);
            color: #000;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.6);
            transform: translateY(-2px);
        }

        .add-button:active {
            transform: translateY(0);
        }

        .item-list {
            margin-top: 20px;
        }

        .item-list-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--cp-text-dim);
            font-size: 14px;
            border: 1px dashed var(--cp-border);
            background: rgba(0, 0, 0, 0.2);
        }

        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: var(--cp-bg-panel);
            border: 1px solid var(--cp-border);
            border-left: 2px solid var(--cp-neon-yellow);
            border-radius: 0;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            position: relative;
        }

        .expense-item::before {
            content: "";
            position: absolute;
            top: -1px;
            right: -1px;
            width: 10px;
            height: 10px;
            border-top: 2px solid var(--cp-neon-yellow);
            border-right: 2px solid var(--cp-neon-yellow);
        }

        .expense-item:hover {
            box-shadow: 0 0 15px rgba(255, 238, 0, 0.1);
            border-color: rgba(255, 238, 0, 0.3);
            z-index: 5;
        }

        .expense-item.completed {
            opacity: 0.5;
            background-color: rgba(0, 0, 0, 0.5);
            border-left-color: #555;
            filter: grayscale(100%);
        }

        .expense-item.completed::before {
            display: none;
        }

        .expense-item.completed .expense-item-name,
        .expense-item.completed .expense-item-amount {
            color: #777;
            text-decoration: line-through;
        }

        .expense-item-info {
            flex: 1;
            min-width: 0;
        }

        .expense-item-name {
            font-weight: 600;
            color: var(--cp-text);
            margin-bottom: 4px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 0;
            transition: all 0.2s ease;
            word-break: break-word;
            font-size: 14px;
        }

        .expense-item-name:hover {
            color: var(--cp-neon-yellow);
            text-shadow: 0 0 5px var(--cp-neon-yellow);
        }

        .expense-item-name.editing {
            background-color: rgba(255, 238, 0, 0.1);
            border: 1px dashed var(--cp-neon-yellow);
        }

        .expense-item-name input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid var(--cp-neon-yellow);
            background: #000;
            color: var(--cp-neon-yellow);
            border-radius: 0;
            font-size: 14px;
            font-family: inherit;
        }

        .expense-item-amount {
            font-size: 16px;
            color: var(--cp-neon-yellow);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 0;
            transition: all 0.2s ease;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        .expense-item-amount:hover {
            background-color: rgba(255, 238, 0, 0.1);
        }

        .expense-item-amount.editing {
            background-color: rgba(255, 238, 0, 0.1);
            border: 1px dashed var(--cp-neon-yellow);
        }

        .expense-item-amount input {
            width: 100px;
            padding: 4px 8px;
            border: 1px solid var(--cp-neon-yellow);
            background: #000;
            color: var(--cp-neon-yellow);
            border-radius: 0;
            font-size: 14px;
            font-family: 'Orbitron', sans-serif;
        }

        .expense-item-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-left: 10px;
            flex-shrink: 0;
        }

        .expense-item-actions button {
            padding: 6px 10px;
            border: 1px solid #444;
            border-radius: 0;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            white-space: nowrap;
            background: transparent;
            color: #aaa;
        }

        .btn-complete {
            border-color: var(--cp-neon-green) !important;
            color: var(--cp-neon-green) !important;
        }

        .btn-complete:hover {
            background: var(--cp-neon-green) !important;
            color: #000 !important;
            box-shadow: 0 0 10px var(--cp-neon-green);
        }

        .btn-delete {
            border-color: #ff3333 !important;
            color: #ff3333 !important;
        }

        .btn-delete:hover {
            background: #ff3333 !important;
            color: white !important;
            box-shadow: 0 0 10px #ff3333;
        }

        .expense-item.completed .btn-complete {
            border-color: #555 !important;
            color: #555 !important;
        }

        .income-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: var(--cp-bg-panel);
            border: 1px solid var(--cp-border);
            border-left: 2px solid var(--cp-neon-green);
            border-radius: 0;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            position: relative;
        }

        .income-item::before {
            content: "";
            position: absolute;
            top: -1px;
            right: -1px;
            width: 10px;
            height: 10px;
            border-top: 2px solid var(--cp-neon-green);
            border-right: 2px solid var(--cp-neon-green);
        }

        .income-item:hover {
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.1);
            border-color: rgba(0, 255, 65, 0.3);
            z-index: 5;
        }

        .income-item.inactive {
            opacity: 0.5;
            background-color: rgba(0, 0, 0, 0.5);
            border-left-color: #555;
            filter: grayscale(100%);
        }

        .income-item.inactive::before {
            display: none;
        }

        .income-item.inactive .income-item-name,
        .income-item.inactive .income-item-amount {
            color: #777;
            text-decoration: line-through;
        }

        .income-item-info {
            flex: 1;
            min-width: 0;
        }

        .income-item-name {
            font-weight: 600;
            color: var(--cp-text);
            margin-bottom: 4px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 0;
            transition: all 0.2s ease;
            word-break: break-word;
            font-size: 14px;
        }

        .income-item-name:hover {
            color: var(--cp-neon-green);
            text-shadow: 0 0 5px var(--cp-neon-green);
        }

        .income-item-name.editing {
            background-color: rgba(0, 255, 65, 0.1);
            border: 1px dashed var(--cp-neon-green);
        }

        .income-item-name input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid var(--cp-neon-green);
            background: #000;
            color: var(--cp-neon-green);
            border-radius: 0;
            font-size: 14px;
            font-family: inherit;
        }

        .income-item-amount {
            font-size: 16px;
            color: var(--cp-neon-green);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 0;
            transition: all 0.2s ease;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        .income-item-amount:hover {
            background-color: rgba(0, 255, 65, 0.1);
        }

        .income-item-amount.editing {
            background-color: rgba(0, 255, 65, 0.1);
            border: 1px dashed var(--cp-neon-green);
        }

        .income-item-amount input {
            width: 100px;
            padding: 4px 8px;
            border: 1px solid var(--cp-neon-green);
            background: #000;
            color: var(--cp-neon-green);
            border-radius: 0;
            font-size: 14px;
            font-family: 'Orbitron', sans-serif;
        }

        .income-item-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-left: 10px;
            flex-shrink: 0;
        }

        .income-item-actions button {
            padding: 6px 10px;
            border: 1px solid #444;
            border-radius: 0;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            white-space: nowrap;
            background: transparent;
            color: #aaa;
        }

        .btn-toggle {
            border-color: var(--cp-neon-cyan) !important;
            color: var(--cp-neon-cyan) !important;
        }

        .btn-toggle:hover {
            background: var(--cp-neon-cyan) !important;
            color: #000 !important;
            box-shadow: 0 0 10px var(--cp-neon-cyan);
        }

        .btn-delete-income {
            border-color: #ff3333 !important;
            color: #ff3333 !important;
        }

        .btn-delete-income:hover {
            background: #ff3333 !important;
            color: white !important;
            box-shadow: 0 0 10px #ff3333;
        }

        .income-item.inactive .btn-toggle {
            border-color: var(--cp-neon-green) !important;
            color: var(--cp-neon-green) !important;
            background: transparent;
        }

        .income-item.inactive .btn-toggle:hover {
            background: var(--cp-neon-green) !important;
            color: #000 !important;
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 20px;
            }

            .content {
                padding: 15px;
                padding-bottom: calc(75px + env(safe-area-inset-bottom));
            }

            .summary-display {
                padding: 25px 15px;
            }

            .summary-display .amount {
                font-size: 32px;
            }

            .summary-stats {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .form-section {
                padding: 15px;
            }

            .page h2 {
                font-size: 18px;
            }

            .expense-item,
            .income-item {
                flex-direction: row;
                align-items: center;
                padding: 10px;
            }

            .expense-item-actions,
            .income-item-actions {
                display: flex;
                flex-direction: column;
                gap: 5px;
                margin-left: 10px;
                margin-top: 0;
                width: auto;
            }

            .expense-item-actions button,
            .income-item-actions button {
                padding: 6px 8px;
                font-size: 10px;
                min-width: 70px;
            }
        }

        .dragging {
            opacity: 0.9;
            background-color: var(--cp-bg-panel);
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.4);
            transform: scale(1.02);
            position: relative;
            z-index: 100;
            border: 1px solid var(--cp-neon-cyan);
        }

        .amount-input-container {
            display: flex;
            gap: 10px;
            align-items: stretch;
            position: relative;
        }

        .input-relative {
            position: relative;
            flex: 1;
        }

        .amount-input-container input {
            width: 100%;
            padding-right: 35px;
        }

        .btn-clear-input {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            color: var(--cp-text-dim);
            border: 1px solid var(--cp-text-dim);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            z-index: 5;
        }

        .btn-clear-input:hover {
            background: #ff3333;
            color: #fff;
            border-color: #ff3333;
            box-shadow: 0 0 5px #ff3333;
        }

        .inline-edit-container {
            display: flex;
            align-items: center;
            gap: 5px;
            width: 100%;
        }

        .inline-edit-container input {
            flex: 1;
            min-width: 60px;
        }

        .btn-clear-inline {
            background: transparent;
            color: var(--cp-text-dim);
            border: 1px solid var(--cp-text-dim);
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .btn-clear-inline:hover {
            background: #ff3333;
            color: #fff;
            border-color: #ff3333;
        }

        .amount-helper-buttons {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .btn-amount-add {
            padding: 4px 8px;
            font-size: 11px;
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--cp-neon-cyan);
            border: 1px solid rgba(0, 243, 255, 0.3);
            border-radius: 0;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            height: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
        }

        .btn-amount-add:hover {
            background-color: rgba(0, 243, 255, 0.2);
            box-shadow: 0 0 5px rgba(0, 243, 255, 0.3);
        }

        .btn-amount-add:active {
            background-color: var(--cp-neon-cyan);
            color: #000;
        }
    </style>

    <link rel="manifest" href="/manifest.webmanifest">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">

</head>

<body>
    <div class="container">
        <div class="header">
            <h1><span style="color: var(--cp-neon-cyan);">月次</span><span style="color: var(--cp-neon-pink);">収支管理</span>
            </h1>
        </div>

        <div class="content">
            <!-- サマリーページ -->
            <div class="page active" id="summary-page">
                <h2>サマリー</h2>
                <div class="page-content">
                    <div class="summary-display">
                        <p>現在の残金</p>
                        <div class="amount">¥0</div>
                    </div>
                    <div class="summary-stats">
                        <div class="summary-stats-item">
                            <label>収入合計</label>
                            <div class="value" id="summary-income">¥0</div>
                        </div>
                        <div class="summary-stats-item">
                            <label>支出合計</label>
                            <div class="value" id="summary-expense">¥0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 収入入力ページ -->
            <div class="page" id="income-page">
                <h2><span style="font-size: 1.2em;">収入</span> <span
                        style="font-size: 0.8em; color: var(--cp-neon-green);">▲</span></h2>
                <div class="page-content">
                    <div class="form-section">
                        <div class="form-group">
                            <label for="income-name">項目名</label>
                            <input type="text" id="income-name" placeholder="例：給与、ボーナス、副業">
                        </div>
                        <div class="form-group">
                            <label for="income-amount">金額</label>
                            <div class="amount-input-container">
                                <div class="input-relative">
                                    <input type="number" id="income-amount" placeholder="0" min="0">
                                    <button class="btn-clear-input"
                                        onclick="clearInputAmount('income-amount')">×</button>
                                </div>
                                <div class="amount-helper-buttons">
                                    <button class="btn-amount-add"
                                        onclick="addAmountToInput('income-amount', 1000)">+1000</button>
                                    <button class="btn-amount-add"
                                        onclick="addAmountToInput('income-amount', 100)">+100</button>
                                </div>
                            </div>
                        </div>
                        <button class="add-button" id="add-income-btn">+ 追加</button>
                    </div>

                    <div class="item-list" id="income-list">
                        <div class="item-list-empty">登録された収入項目がここに表示されます</div>
                    </div>
                </div>
            </div>

            <!-- 支出入力ページ -->
            <div class="page" id="expense-page">
                <h2><span style="font-size: 1.2em;">支出</span> <span
                        style="font-size: 0.8em; color: var(--cp-neon-yellow);">▼</span></h2>
                <div class="page-content">
                    <div class="form-section">
                        <div class="form-group">
                            <label for="expense-name">項目名</label>
                            <input type="text" id="expense-name" placeholder="例：食費、交通費、娯楽">
                        </div>
                        <div class="form-group">
                            <label for="expense-amount">金額</label>
                            <div class="amount-input-container">
                                <div class="input-relative">
                                    <input type="number" id="expense-amount" placeholder="0" min="0">
                                    <button class="btn-clear-input"
                                        onclick="clearInputAmount('expense-amount')">×</button>
                                </div>
                                <div class="amount-helper-buttons">
                                    <button class="btn-amount-add"
                                        onclick="addAmountToInput('expense-amount', 1000)">+1000</button>
                                    <button class="btn-amount-add"
                                        onclick="addAmountToInput('expense-amount', 100)">+100</button>
                                </div>
                            </div>
                        </div>
                        <button class="add-button" id="add-expense-btn">+ 追加</button>
                    </div>

                    <div class="item-list" id="expense-list">
                        <div class="item-list-empty">登録された支出項目がここに表示されます</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ナビゲーション -->
        <div class="nav">
            <button class="nav-btn active" data-page="summary-page">サマリー</button>
            <button class="nav-btn" data-page="income-page">収入</button>
            <button class="nav-btn" data-page="expense-page">支出</button>
        </div>
    </div>

    <script>
        // ============================================
        // データ管理
        // ============================================

        const STORAGE_KEYS = {
            income: 'budget_app_income',
            expense: 'budget_app_expense'
        };

        let incomeData = [];
        let expenseData = [];

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function loadDataFromStorage() {
            try {
                const storedIncome = localStorage.getItem(STORAGE_KEYS.income);
                const storedExpense = localStorage.getItem(STORAGE_KEYS.expense);

                incomeData = storedIncome ? JSON.parse(storedIncome) : [];
                expenseData = storedExpense ? JSON.parse(storedExpense) : [];

                console.log('データ読み込み完了');
            } catch (error) {
                console.error('データ読み込みエラー:', error);
                incomeData = [];
                expenseData = [];
            }
        }

        function saveDataToStorage() {
            try {
                localStorage.setItem(STORAGE_KEYS.income, JSON.stringify(incomeData));
                localStorage.setItem(STORAGE_KEYS.expense, JSON.stringify(expenseData));
                console.log('データ保存完了');
            } catch (error) {
                console.error('データ保存エラー:', error);
            }
        }

        function addIncome(name, amount) {
            if (!name || name.trim() === '' || isNaN(amount) || amount < 0) {
                alert('項目名と正当な金額を入力してください');
                return null;
            }

            const newIncome = {
                id: generateId(),
                name: name.trim(),
                amount: Number(amount),
                active: true
            };

            incomeData.push(newIncome);
            saveDataToStorage();
            updateSummaryDisplay();
            console.log('収入を追加:', newIncome);
            return newIncome;
        }

        function addExpense(name, amount) {
            if (!name || name.trim() === '' || isNaN(amount) || amount < 0) {
                alert('項目名と正当な金額を入力してください');
                return null;
            }

            const newExpense = {
                id: generateId(),
                name: name.trim(),
                amount: Number(amount),
                active: true
            };

            expenseData.push(newExpense);
            saveDataToStorage();
            updateSummaryDisplay();
            console.log('支出を追加:', newExpense);
            return newExpense;
        }

        function updateIncome(id, updates) {
            const income = incomeData.find(item => item.id === id);
            if (income) {
                Object.assign(income, updates);
                saveDataToStorage();
                updateSummaryDisplay();
                console.log('収入を更新:', income);
            }
        }

        function updateExpense(id, updates) {
            const expense = expenseData.find(item => item.id === id);
            if (expense) {
                Object.assign(expense, updates);
                saveDataToStorage();
                updateSummaryDisplay();
                console.log('支出を更新:', expense);
            }
        }

        function deleteExpense(id) {
            const index = expenseData.findIndex(item => item.id === id);
            if (index !== -1) {
                expenseData.splice(index, 1);
                saveDataToStorage();
                updateSummaryDisplay();
                console.log('支出を削除');
            }
        }

        // ============================================
        // ドラッグ＆ドロップ並べ替え
        // ============================================

        function enableDragAndDrop(listId, type, renderCallback) {
            const listElement = document.getElementById(listId);
            let draggedItem = null;
            let touchTimer = null;
            let startY = 0;
            let initialIndex = -1;

            listElement.addEventListener('touchstart', (e) => {
                const item = e.target.closest('.expense-item, .income-item');
                // 入力フォームやボタンでのタッチは除外
                if (!item || e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON') return;

                startY = e.touches[0].clientY;

                // 長押し判定 (500ms)
                touchTimer = setTimeout(() => {
                    draggedItem = item;
                    initialIndex = Array.from(listElement.children).indexOf(item);
                    item.classList.add('dragging');
                    // 振動フィードバック (対応デバイスのみ)
                    if (navigator.vibrate) navigator.vibrate(50);
                }, 500);
            }, { passive: false });

            listElement.addEventListener('touchmove', (e) => {
                if (!draggedItem) {
                    // 長押し成立前に大きく動かしたらキャンセル
                    if (touchTimer && Math.abs(e.touches[0].clientY - startY) > 10) {
                        clearTimeout(touchTimer);
                        touchTimer = null;
                    }
                    return;
                }

                e.preventDefault(); // スクロール阻止
                const touch = e.touches[0];
                const elementAfter = getDragAfterElement(listElement, touch.clientY);

                if (elementAfter == null) {
                    listElement.appendChild(draggedItem);
                } else {
                    listElement.insertBefore(draggedItem, elementAfter);
                }
            }, { passive: false });

            listElement.addEventListener('touchend', () => {
                if (touchTimer) clearTimeout(touchTimer);
                if (!draggedItem) return;

                draggedItem.classList.remove('dragging');

                // データ配列の並び替え
                updateDataOrder(listElement, type);

                draggedItem = null;
                touchTimer = null;
            });

            // キャンセル関連
            listElement.addEventListener('touchcancel', () => {
                if (touchTimer) clearTimeout(touchTimer);
                if (draggedItem) {
                    draggedItem.classList.remove('dragging');
                    draggedItem = null;
                    // 元に戻す処理が必要なら追加（今回は簡略化のため現状維持で再描画が安全かも）
                    renderCallback();
                }
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.expense-item:not(.dragging), .income-item:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function updateDataOrder(container, type) {
            // 対象のデータ配列を取得
            const dataArray = (type === 'income') ? incomeData : expenseData;
            const newOrderIds = Array.from(container.children).map(el => {
                // DOM要素からIDを特定する必要がある。
                // 現在のレンダリング処理でdata-id属性などを付与していない場合、追加が必要。
                // 仮にレンダリング時に activeInputId などを参照している箇所があるが、
                // DOMにIDを持たせるのが確実。
                return el.dataset.id;
            }).filter(id => id); // 空のIDを除外

            // IDに基づいて配列を再構築
            const newDataArray = [];
            newOrderIds.forEach(id => {
                const item = dataArray.find(d => d.id === id);
                if (item) newDataArray.push(item);
            });

            // dataArrayの中身を入れ替える
            // (参照渡しされた配列の中身を書き換える必要があるため、spliceを使う)
            if (newDataArray.length === dataArray.length) {
                dataArray.splice(0, dataArray.length, ...newDataArray);
                saveDataToStorage();
                console.log('並び替え保存完了');
            }
        }

        function deleteIncome(id) {
            const index = incomeData.findIndex(item => item.id === id);
            if (index !== -1) {
                incomeData.splice(index, 1);
                saveDataToStorage();
                updateSummaryDisplay();
                console.log('収入を削除');
            }
        }

        function clearAllData() {
            incomeData = [];
            expenseData = [];
            localStorage.removeItem(STORAGE_KEYS.income);
            localStorage.removeItem(STORAGE_KEYS.expense);
            console.log('すべてのデータをクリアしました');
        }

        // ============================================
        // 計算処理
        // ============================================

        function calculateTotalIncome() {
            return incomeData
                .filter(item => item.active === true)
                .reduce((sum, item) => sum + item.amount, 0);
        }

        function calculateTotalExpense() {
            return expenseData
                .filter(item => item.active === true)
                .reduce((sum, item) => sum + item.amount, 0);
        }

        function calculateBalance() {
            return calculateTotalIncome() - calculateTotalExpense();
        }

        function formatCurrency(amount) {
            return '¥' + Math.floor(amount).toLocaleString('ja-JP');
        }

        function updateSummaryDisplay() {
            const balance = calculateBalance();
            const totalIncome = calculateTotalIncome();
            const totalExpense = calculateTotalExpense();

            const amountElement = document.querySelector('#summary-page .summary-display .amount');
            if (amountElement) {
                amountElement.textContent = formatCurrency(balance);
            }

            const incomeElement = document.getElementById('summary-income');
            if (incomeElement) {
                incomeElement.textContent = formatCurrency(totalIncome);
            }

            const expenseElement = document.getElementById('summary-expense');
            if (expenseElement) {
                expenseElement.textContent = formatCurrency(totalExpense);
            }

            console.log('サマリーを更新: 残金=' + formatCurrency(balance));
        }

        // ============================================
        // 収入リストの表示と更新
        // ============================================

        function renderIncomeList() {
            const incomeList = document.getElementById('income-list');

            if (incomeData.length === 0) {
                incomeList.innerHTML = '<div class="item-list-empty">登録された収入項目がここに表示されます</div>';
                return;
            }

            incomeList.innerHTML = incomeData.map(income => {
                const isInactive = !income.active;
                return '<div class="income-item ' + (isInactive ? 'inactive' : '') + '" data-id="' + income.id + '">' +
                    '<div class="income-item-info">' +
                    '<div class="income-item-name" onclick="toggleEditIncomeName(\'' + income.id + '\')">' +
                    '<span class="name-display">' + escapeHtml(income.name) + '</span>' +
                    '<input class="name-input" type="text" value="' + escapeHtml(income.name) + '" style="display: none;" onblur="saveIncomeName(\'' + income.id + '\')" onkeypress="if(event.key===\'Enter\') saveIncomeName(\'' + income.id + '\')">' +
                    '</div>' +
                    '<div class="income-item-amount" onclick="toggleEditIncomeAmount(\'' + income.id + '\')">' +
                    '<span class="amount-display">' + formatCurrency(income.amount) + '</span>' +
                    '<div class="inline-edit-container" style="display: none;">' +
                    '<input class="amount-input" type="number" value="' + income.amount + '" onblur="saveIncomeAmount(\'' + income.id + '\')" onkeypress="if(event.key===\'Enter\') saveIncomeAmount(\'' + income.id + '\')">' +
                    '<button class="btn-clear-inline" onmousedown="event.preventDefault(); clearInlineInput(this)">×</button>' +
                    '</div>' +
                    '</div>' +
                    '</div>' +
                    '<div class="income-item-actions">' +
                    '<button class="btn-toggle" onclick="toggleIncomeActive(\'' + income.id + '\')">' + (isInactive ? '有効' : '無効') + '</button>' +
                    '<button class="btn-delete-income" onclick="deleteIncomeItem(\'' + income.id + '\')">削除</button>' +
                    '</div>' +
                    '</div>';
            }).join('');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function toggleEditIncomeName(id) {
            const item = document.querySelector('.income-item[data-id="' + id + '"] .income-item-name');
            const display = item.querySelector('.name-display');
            const input = item.querySelector('.name-input');

            if (input.style.display === 'none') {
                display.style.display = 'none';
                input.style.display = 'block';
                input.focus();
                item.classList.add('editing');
            }
        }

        function saveIncomeName(id) {
            const item = document.querySelector('.income-item[data-id="' + id + '"] .income-item-name');
            const display = item.querySelector('.name-display');
            const input = item.querySelector('.name-input');
            const newName = input.value.trim();

            if (newName) {
                updateIncome(id, { name: newName });
                display.textContent = newName;
            }

            display.style.display = 'block';
            input.style.display = 'none';
            item.classList.remove('editing');
            renderIncomeList();
        }

        function toggleEditIncomeAmount(id) {
            const item = document.querySelector('.income-item[data-id="' + id + '"] .income-item-amount');
            const display = item.querySelector('.amount-display');
            const container = item.querySelector('.inline-edit-container');
            const input = item.querySelector('.amount-input');

            if (container.style.display === 'none') {
                display.style.display = 'none';
                container.style.display = 'flex';
                input.focus();
                item.classList.add('editing');
            }
        }

        function saveIncomeAmount(id) {
            const item = document.querySelector('.income-item[data-id="' + id + '"] .income-item-amount');
            const display = item.querySelector('.amount-display');
            const container = item.querySelector('.inline-edit-container');
            const input = item.querySelector('.amount-input');
            const newAmount = Number(input.value);

            if (!isNaN(newAmount) && newAmount >= 0) {
                updateIncome(id, { amount: newAmount });
                display.textContent = formatCurrency(newAmount);
            } else {
                alert('正当な金額を入力してください');
            }

            display.style.display = 'block';
            container.style.display = 'none';
            item.classList.remove('editing');
            renderIncomeList();
        }

        function toggleIncomeActive(id) {
            const income = incomeData.find(item => item.id === id);
            if (income) {
                updateIncome(id, { active: !income.active });
                renderIncomeList();
            }
        }

        function deleteIncomeItem(id) {
            if (confirm('この収入項目を削除しますか？')) {
                deleteIncome(id);
                renderIncomeList();
            }
        }

        // ============================================
        // 支出リストの表示と更新
        // ============================================

        function renderExpenseList() {
            const expenseList = document.getElementById('expense-list');

            if (expenseData.length === 0) {
                expenseList.innerHTML = '<div class="item-list-empty">登録された支出項目がここに表示されます</div>';
                return;
            }

            expenseList.innerHTML = expenseData.map(expense => {
                const isCompleted = !expense.active;
                return '<div class="expense-item ' + (isCompleted ? 'completed' : '') + '" data-id="' + expense.id + '">' +
                    '<div class="expense-item-info">' +
                    '<div class="expense-item-name" onclick="toggleEditExpenseName(\'' + expense.id + '\')">' +
                    '<span class="name-display">' + escapeHtml(expense.name) + '</span>' +
                    '<input class="name-input" type="text" value="' + escapeHtml(expense.name) + '" style="display: none;" onblur="saveExpenseName(\'' + expense.id + '\')" onkeypress="if(event.key===\'Enter\') saveExpenseName(\'' + expense.id + '\')">' +
                    '</div>' +
                    '<div class="expense-item-amount" onclick="toggleEditExpenseAmount(\'' + expense.id + '\')">' +
                    '<span class="amount-display">' + formatCurrency(expense.amount) + '</span>' +
                    '<div class="inline-edit-container" style="display: none;">' +
                    '<input class="amount-input" type="number" value="' + expense.amount + '" onblur="saveExpenseAmount(\'' + expense.id + '\')" onkeypress="if(event.key===\'Enter\') saveExpenseAmount(\'' + expense.id + '\')">' +
                    '<button class="btn-clear-inline" onmousedown="event.preventDefault(); clearInlineInput(this)">×</button>' +
                    '</div>' +
                    '</div>' +
                    '</div>' +
                    '<div class="expense-item-actions">' +
                    '<button class="btn-complete" onclick="toggleExpenseComplete(\'' + expense.id + '\')">' + (isCompleted ? '未完了' : '支払い完了') + '</button>' +
                    '<button class="btn-delete" onclick="deleteExpenseItem(\'' + expense.id + '\')">削除</button>' +
                    '</div>' +
                    '</div>';
            }).join('');
        }

        function toggleEditExpenseName(id) {
            const item = document.querySelector('.expense-item[data-id="' + id + '"] .expense-item-name');
            const display = item.querySelector('.name-display');
            const input = item.querySelector('.name-input');

            if (input.style.display === 'none') {
                display.style.display = 'none';
                input.style.display = 'block';
                input.focus();
                item.classList.add('editing');
            }
        }

        function saveExpenseName(id) {
            const item = document.querySelector('.expense-item[data-id="' + id + '"] .expense-item-name');
            const display = item.querySelector('.name-display');
            const input = item.querySelector('.name-input');
            const newName = input.value.trim();

            if (newName) {
                updateExpense(id, { name: newName });
                display.textContent = newName;
            }

            display.style.display = 'block';
            input.style.display = 'none';
            item.classList.remove('editing');
            renderExpenseList();
        }

        function toggleEditExpenseAmount(id) {
            const item = document.querySelector('.expense-item[data-id="' + id + '"] .expense-item-amount');
            const display = item.querySelector('.amount-display');
            const container = item.querySelector('.inline-edit-container');
            const input = item.querySelector('.amount-input');

            if (container.style.display === 'none') {
                display.style.display = 'none';
                container.style.display = 'flex';
                input.focus();
                item.classList.add('editing');
            }
        }

        function saveExpenseAmount(id) {
            const item = document.querySelector('.expense-item[data-id="' + id + '"] .expense-item-amount');
            const display = item.querySelector('.amount-display');
            const container = item.querySelector('.inline-edit-container');
            const input = item.querySelector('.amount-input');
            const newAmount = Number(input.value);

            if (!isNaN(newAmount) && newAmount >= 0) {
                updateExpense(id, { amount: newAmount });
                display.textContent = formatCurrency(newAmount);
            } else {
                alert('正当な金額を入力してください');
            }

            display.style.display = 'block';
            container.style.display = 'none';
            item.classList.remove('editing');
            renderExpenseList();
        }

        function toggleExpenseComplete(id) {
            const expense = expenseData.find(item => item.id === id);
            if (expense) {
                updateExpense(id, { active: !expense.active });
                renderExpenseList();
            }
        }

        function deleteExpenseItem(id) {
            if (confirm('この支出項目を削除しますか？')) {
                deleteExpense(id);
                renderExpenseList();
            }
        }

        // ============================================
        // ページ読み込み時の初期化
        // ============================================
        document.addEventListener('DOMContentLoaded', function () {
            loadDataFromStorage();
            updateSummaryDisplay();
            renderExpenseList();
            renderIncomeList();

            // ドラッグ＆ドロップの有効化
            enableDragAndDrop('income-list', 'income', renderIncomeList);
            enableDragAndDrop('expense-list', 'expense', renderExpenseList);

            document.getElementById('add-expense-btn').addEventListener('click', function () {
                const nameInput = document.getElementById('expense-name');
                const amountInput = document.getElementById('expense-amount');
                const name = nameInput.value.trim();
                const amount = Number(amountInput.value);

                if (addExpense(name, amount)) {
                    nameInput.value = '';
                    amountInput.value = '';
                    renderExpenseList();
                }
            });

            document.getElementById('add-income-btn').addEventListener('click', function () {
                const nameInput = document.getElementById('income-name');
                const amountInput = document.getElementById('income-amount');
                const name = nameInput.value.trim();
                const amount = Number(amountInput.value);

                if (addIncome(name, amount)) {
                    nameInput.value = '';
                    amountInput.value = '';
                    renderIncomeList();
                }
            });
        });

        // ============================================
        // ページ切り替え機能
        // ============================================
        document.querySelectorAll('.nav-btn').forEach(button => {
            button.addEventListener('click', function () {
                const pageId = this.getAttribute('data-page');

                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });

                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                document.getElementById(pageId).classList.add('active');
                this.classList.add('active');
            });
        });

        function addAmountToInput(inputId, amount) {
            const input = document.getElementById(inputId);
            const currentValue = Number(input.value) || 0;
            input.value = currentValue + amount;
            input.focus();
        }

        function clearInputAmount(inputId) {
            const input = document.getElementById(inputId);
            input.value = '';
            input.focus();
        }

        function clearInlineInput(btn) {
            const container = btn.parentElement;
            const input = container.querySelector('input');
            input.value = '';
            input.focus();
        }
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(console.error);
            });
        }
    </script>

</body>

</html>